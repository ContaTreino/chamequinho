<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamequinho Pro - Criador Profissional de Fotos</title>
    <meta name="description" content="Ferramenta profissional para criar chamequinhos com grid personalizável, seleção individual e download em alta qualidade">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- html2canvas para download -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-hue: 142;
            --primary-sat: 76%;
            --primary-light: 36%;
            --secondary-hue: 210;
            --secondary-sat: 100%;
            --secondary-light: 56%;
            --accent-hue: 45;
            --accent-sat: 100%;
            --accent-light: 51%;
            --surface: #ffffff;
            --surface-variant: #f8fafc;
            --on-surface: #0f172a;
            --on-surface-variant: #64748b;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, var(--surface) 0%, var(--surface-variant) 100%);
            color: var(--on-surface);
            line-height: 1.6;
        }

        /* Gradients */
        .gradient-primary {
            background: linear-gradient(135deg, hsl(var(--primary-hue), var(--primary-sat), var(--primary-light)), hsl(var(--primary-hue), var(--primary-sat), 45%));
        }

        .gradient-secondary {
            background: linear-gradient(135deg, hsl(var(--secondary-hue), var(--secondary-sat), var(--secondary-light)), hsl(var(--secondary-hue), var(--secondary-sat), 65%));
        }

        .gradient-accent {
            background: linear-gradient(135deg, hsl(var(--accent-hue), var(--accent-sat), var(--accent-light)), hsl(var(--accent-hue), var(--accent-sat), 60%));
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 10px var(--shadow);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Cards */
        .card {
            border: 1px solid var(--border);
            border-radius: 16px;
            background: var(--surface);
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        /* Buttons */
        .btn-gradient {
            background: linear-gradient(135deg, hsl(var(--primary-hue), var(--primary-sat), var(--primary-light)), hsl(var(--primary-hue), var(--primary-sat), 45%));
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            padding: 12px 24px;
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
            color: white;
        }

        .btn-outline-gradient {
            border: 2px solid hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            background: transparent;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-gradient:hover {
            background: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            color: white;
            transform: translateY(-1px);
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(59, 130, 246, 0.05));
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area.dragover {
            border-color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));
            transform: scale(1.02);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        /* Grid */
        .photo-grid {
            display: grid;
            gap: clamp(4px, 1vw, 12px);
            background: white;
            padding: clamp(12px, 3vw, 24px);
            border-radius: 10px;
            box-shadow: 0 4px 20px var(--shadow);
            max-width: min(95vw, 1200px);
            margin: 0 auto;
            width: 100%;
        }

        .grid-slot {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: clamp(8px, 1.5vw, 12px);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: linear-gradient(135deg, var(--surface-variant), #f1f5f9);
            min-height: 50px;
        }

        .grid-slot:hover {
            border-color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            transform: scale(1.02);
            box-shadow: 0 8px 25px var(--shadow);
            z-index: 2;
        }

        .grid-slot img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            border-radius: inherit;
        }

        .grid-slot:hover img {
            transform: scale(1.03);
        }

        .grid-slot.cover-mode img {
            object-fit: cover;
        }

        .grid-slot.contain-mode img {
            object-fit: contain;
            background: #f8fafc;
        }

        .grid-slot-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--on-surface-variant);
            font-size: 2rem;
            background: linear-gradient(135deg, var(--surface-variant), #f1f5f9);
        }

        .grid-slot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .grid-slot:hover .grid-slot-overlay {
            background: rgba(0, 0, 0, 0.3);
            opacity: 1;
        }

        .position-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .grid-slot:hover .position-badge {
            opacity: 1;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-emerald {
            background: hsl(var(--primary-hue), var(--primary-sat), 95%);
            color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            border: 1px solid hsl(var(--primary-hue), var(--primary-sat), 85%);
        }

        .badge-ocean {
            background: hsl(var(--secondary-hue), var(--secondary-sat), 95%);
            color: hsl(var(--secondary-hue), var(--secondary-sat), var(--secondary-light));
            border: 1px solid hsl(var(--secondary-hue), var(--secondary-sat), 85%);
        }

        .badge-golden {
            background: hsl(var(--accent-hue), var(--accent-sat), 95%);
            color: hsl(var(--accent-hue), var(--accent-sat), var(--accent-light));
            border: 1px solid hsl(var(--accent-hue), var(--accent-sat), 85%);
        }

        /* Range Slider */
        .range-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--surface-variant);
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .range-slider:hover {
            opacity: 1;
        }

        .range-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gradient-primary);
            cursor: pointer;
            box-shadow: 0 2px 6px var(--shadow);
        }

        /* Image Thumbnails */
        .image-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .image-thumbnail {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .image-thumbnail:hover {
            border-color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            transform: scale(1.05);
        }

        .image-thumbnail.selected {
            border-color: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
        }

        .image-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-check {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: hsl(var(--primary-hue), var(--primary-sat), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-thumbnail.selected .thumbnail-check {
            opacity: 1;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Progress Bar */
        .progress {
            height: 8px;
            border-radius: 4px;
            background: var(--surface-variant);
            overflow: hidden;
        }

        .progress-bar {
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        /* Extra Small Devices (portrait phones, less than 576px) */
        @media (max-width: 575.98px) {
            .photo-grid {
                padding: 8px;
                gap: 2px;
                margin: 0 8px;
            }
            
            .upload-area {
                padding: 1.5rem 0.75rem;
                margin: 0 8px;
            }
            
            .grid-slot {
                border-radius: 6px;
                min-height: 40px;
            }
            
            .container {
                padding-left: 8px;
                padding-right: 8px;
            }
            
            .display-4 {
                font-size: 1.8rem;
            }
            
            .lead {
                font-size: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.875rem;
            }
        }

        /* Small Devices (landscape phones, 576px and up) */
        @media (min-width: 576px) and (max-width: 767.98px) {
            .photo-grid {
                padding: 12px;
                gap: 3px;
                margin: 0 12px;
            }
            
            .upload-area {
                padding: 2rem 1rem;
            }
            
            .grid-slot {
                border-radius: 8px;
                min-height: 45px;
            }
        }

        /* Medium Devices (tablets, 768px and up) */
        @media (min-width: 768px) and (max-width: 991.98px) {
            .photo-grid {
                padding: 16px;
                gap: 6px;
                max-width: 90vw;
            }
            
            .grid-slot {
                min-height: 60px;
            }
            
            .image-thumbnails {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        /* Large Devices (desktops, 992px and up) */
        @media (min-width: 992px) and (max-width: 1199.98px) {
            .photo-grid {
                padding: 20px;
                gap: 8px;
                max-width: 95vw;
            }
            
            .grid-slot {
                min-height: 80px;
            }
        }

        /* Extra Large Devices (large desktops, 1200px and up) */
        @media (min-width: 1200px) {
            .photo-grid {
                padding: 24px;
                gap: 12px;
                max-width: 1200px;
            }
            
            .grid-slot {
                min-height: 100px;
            }
            
            .image-thumbnails {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        /* Landscape Orientation Specific */
        @media (orientation: landscape) and (max-height: 600px) {
            .photo-grid {
                max-height: 70vh;
            }
            
            .container {
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
        }

        /* High DPI Displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .grid-slot img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }

        /* Accessibility - Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --surface: #0f172a;
                --surface-variant: #1e293b;
                --on-surface: #f8fafc;
                --on-surface-variant: #cbd5e1;
                --border: #334155;
                --shadow: rgba(0, 0, 0, 0.3);
            }
            
            .grid-slot img {
                background: #1e293b;
            }
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .grid-slot-overlay,
            .position-badge,
            .btn,
            .no-print {
                display: none !important;
            }
            @page {
                margin: 0.5in;
                size: A4;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header sticky-top">
        <div class="container py-3">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="d-flex align-items-center gap-3">
                        <div class="logo-icon gradient-primary">
                            <i class="bi bi-camera-fill fs-4"></i>
                        </div>
                        <div>
                            <h1 class="h4 mb-0">Chamequinho Pro</h1>
                            <small class="text-muted">Criador profissional de fotos</small>
                        </div>
                    </div>
                </div>
                <div class="col-auto ms-auto">
                    <div class="d-flex gap-2">
                        <span class="badge badge-golden">
                            <i class="bi bi-lightning-fill me-1"></i>Premium
                        </span>
                        <span class="badge badge-emerald">
                            <i class="bi bi-stars me-1"></i>Grátis
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container py-5">
        <!-- Hero Section -->
        <div class="text-center mb-5 animate-fade-in-up">
            <h2 class="display-4 fw-bold mb-3">
                Crie seus chamequinhos<br>
                <span class="text-gradient gradient-primary">com precisão profissional</span>
            </h2>
            <p class="lead text-muted mb-4 mx-auto" style="max-width: 600px;">
                Interface avançada com seleção individual por posição, drag & drop inteligente
                e download em alta qualidade. A ferramenta definitiva para seus documentos.
            </p>
            <div class="d-flex flex-wrap justify-content-center gap-3 text-muted small">
                <div class="d-flex align-items-center gap-2">
                    <div class="bg-success rounded-circle" style="width: 8px; height: 8px;"></div>
                    <span>Grid até 10×10 posições</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <div class="bg-primary rounded-circle" style="width: 8px; height: 8px;"></div>
                    <span>Seleção individual</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <div class="bg-warning rounded-circle" style="width: 8px; height: 8px;"></div>
                    <span>Qualidade 300 DPI</span>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="logo-icon gradient-secondary" style="width: 40px; height: 40px;">
                                <i class="bi bi-cloud-upload"></i>
                            </div>
                            <div>
                                <h3 class="h5 mb-0">Upload de Imagens</h3>
                                <small class="text-muted">Arraste e solte ou clique para selecionar (máx. 10 imagens)</small>
                            </div>
                        </div>
                        
                        <div class="upload-area" id="uploadArea">
                            <div class="mb-3">
                                <div class="logo-icon gradient-primary mx-auto mb-3" style="width: 80px; height: 80px;">
                                    <i class="bi bi-images display-4"></i>
                                </div>
                                <h4 class="h5 mb-2">Clique aqui ou arraste suas imagens</h4>
                                <p class="text-muted mb-3">Suporte para JPG, PNG, WEBP • Máximo 5MB por imagem</p>
                                <button class="btn btn-gradient" onclick="document.getElementById('fileInput').click()">
                                    <i class="bi bi-plus-circle me-2"></i>Selecionar Imagens
                                </button>
                            </div>
                            <input type="file" id="fileInput" multiple accept="image/*" class="d-none">
                        </div>

                        <!-- Progress Bar -->
                        <div class="progress mt-3 d-none" id="uploadProgress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>

                        <!-- Image Thumbnails -->
                        <div class="image-thumbnails mt-4 d-none" id="imageThumbnails"></div>

                        <!-- Upload Stats -->
                        <div class="row mt-4 text-center d-none" id="uploadStats">
                            <div class="col-4">
                                <div class="h4 mb-0 text-success" id="imageCount">0</div>
                                <small class="text-muted">Imagens</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 mb-0 text-primary" id="totalSize">0MB</div>
                                <small class="text-muted">Tamanho Total</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 mb-0 text-warning" id="avgSize">0MB</div>
                                <small class="text-muted">Média por Foto</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid Configuration and Preview -->
        <div class="row">
            <!-- Configuration Panel -->
            <div class="col-xl-3 col-lg-4 mb-4">
                <!-- Grid Configuration -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="logo-icon gradient-primary" style="width: 40px; height: 40px;">
                                <i class="bi bi-grid-3x3"></i>
                            </div>
                            <h3 class="h5 mb-0">Configuração do Grid</h3>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label mb-0">Colunas (Horizontal)</label>
                                <span class="badge badge-ocean" id="colsValue">3</span>
                            </div>
                            <input type="range" class="range-slider" id="colsRange" min="1" max="10" value="3">
                            <small class="text-muted">Máximo: 10 colunas</small>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label mb-0">Linhas (Vertical)</label>
                                <span class="badge badge-emerald" id="rowsValue">3</span>
                            </div>
                            <input type="range" class="range-slider" id="rowsRange" min="1" max="10" value="3">
                            <small class="text-muted">Máximo: 10 linhas</small>
                        </div>

                        <div class="pt-3 border-top">
                            <div class="d-flex align-items-center gap-2 text-muted">
                                <i class="bi bi-grid"></i>
                                <span>Total: <strong class="text-body" id="totalSlots">9 fotos</strong></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="logo-icon gradient-secondary" style="width: 40px; height: 40px;">
                                <i class="bi bi-bar-chart"></i>
                            </div>
                            <h3 class="h5 mb-0">Estatísticas</h3>
                        </div>

                        <div class="row text-center">
                            <div class="col-12 mb-3">
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Imagens carregadas:</span>
                                    <span class="badge badge-emerald" id="statsImages">0</span>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Posições totais:</span>
                                    <span class="badge badge-ocean" id="statsSlots">9</span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Formato final:</span>
                                    <span class="badge badge-golden">A4</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grid Panel -->
            <div class="col-xl-9 col-lg-8">
                <div class="card">
                    <div class="card-body">
                        <!-- Grid Header -->
                        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-3 mb-4">
                            <div>
                                <h3 class="h5 mb-1">Grid Interativo</h3>
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge bg-secondary" id="gridInfo">3 × 3 = 9 posições</span>
                                    <span class="badge badge-emerald" id="filledInfo">0/9 preenchidas</span>
                                </div>
                            </div>
                            
                            <div class="d-flex flex-wrap gap-2">
                                <div class="btn-group me-2" role="group">
                                    <input type="radio" class="btn-check" name="fitMode" id="fitContain" value="contain" checked>
                                    <label class="btn btn-outline-secondary btn-sm" for="fitContain">
                                        <i class="bi bi-aspect-ratio me-1"></i>Ajustar
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="fitMode" id="fitCover" value="cover">
                                    <label class="btn btn-outline-secondary btn-sm" for="fitCover">
                                        <i class="bi bi-crop me-1"></i>Preencher
                                    </label>
                                </div>
                                <button class="btn btn-outline-gradient btn-sm" onclick="fillAllSlots()">
                                    <i class="bi bi-copy me-1"></i>Preencher Tudo
                                </button>
                                <button class="btn btn-outline-gradient btn-sm" onclick="randomFillSlots()">
                                    <i class="bi bi-shuffle me-1"></i>Aleatório
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="clearAllSlots()">
                                    <i class="bi bi-trash me-1"></i>Limpar
                                </button>
                                <button class="btn btn-outline-primary btn-sm no-print" onclick="printGrid()">
                                    <i class="bi bi-printer me-1"></i>Imprimir
                                </button>
                                <button class="btn btn-gradient btn-sm no-print" onclick="downloadGrid()">
                                    <i class="bi bi-download me-1"></i>Baixar HD
                                </button>
                            </div>
                        </div>

                        <!-- Photo Grid -->
                        <div class="photo-grid print-area" id="photoGrid">
                            <!-- Grid slots will be generated by JavaScript -->
                        </div>

                        <!-- Instructions -->
                        <div class="alert alert-info mt-4 no-print">
                            <div class="d-flex align-items-start gap-3">
                                <i class="bi bi-info-circle text-primary"></i>
                                <div>
                                    <h6 class="alert-heading">Como usar o Grid Interativo</h6>
                                    <ul class="mb-0 small">
                                        <li><strong>Clique</strong> em qualquer posição para escolher uma imagem</li>
                                        <li>Use <strong>"Preencher Tudo"</strong> para aplicar a primeira imagem em todas as posições</li>
                                        <li><strong>"Aleatório"</strong> distribui suas imagens de forma automática</li>
                                        <li>Passe o mouse sobre as imagens para ver as opções</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Image Selection Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-image me-2"></i>
                        Selecionar Imagem - Posição <span id="modalPosition">1</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="image-thumbnails" id="modalThumbnails">
                                <!-- Thumbnails will be generated by JavaScript -->
                            </div>
                        </div>
                        <div class="col-lg-4" id="previewPanel" style="display: none;">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">Preview</h6>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="hidePreview()">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                    <div class="mb-3">
                                        <img id="previewImage" class="img-fluid rounded" style="width: 100%; aspect-ratio: 1; object-fit: cover;">
                                    </div>
                                    <div id="previewInfo" class="small text-muted mb-3">
                                        <!-- Image info will be populated by JavaScript -->
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-gradient btn-sm" onclick="selectImageFromPreview()">
                                            <i class="bi bi-check me-1"></i>Usar Esta
                                        </button>
                                        <button class="btn btn-outline-gradient btn-sm" onclick="copyToAllFromPreview()">
                                            <i class="bi bi-copy me-1"></i>Aplicar a Todas
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="clearSlot()">
                        <i class="bi bi-trash me-1"></i>Limpar Posição
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let uploadedImages = [];
        let gridSlots = [];
        let currentRows = 3;
        let currentCols = 3;
        let currentSlotIndex = 0;
        let currentPreviewIndex = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeGrid();
            setupEventListeners();
            updateStats();
        });

        // Setup event listeners
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            const colsRange = document.getElementById('colsRange');
            const rowsRange = document.getElementById('rowsRange');

            // File input change
            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);

            // Range sliders
            colsRange.addEventListener('input', function() {
                currentCols = parseInt(this.value);
                document.getElementById('colsValue').textContent = currentCols;
                updateGrid();
            });

            rowsRange.addEventListener('input', function() {
                currentRows = parseInt(this.value);
                document.getElementById('rowsValue').textContent = currentRows;
                updateGrid();
            });

            // Image fit mode toggle
            const fitModeRadios = document.querySelectorAll('input[name="fitMode"]');
            fitModeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateImageFitMode(this.value);
                });
            });
        }

        // Handle file selection
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            processFiles(files);
        }

        // Handle drag and drop
        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
            const files = Array.from(event.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            processFiles(files);
        }

        // Process uploaded files
        function processFiles(files) {
            if (files.length === 0) return;

            // Limit to 10 images
            const remainingSlots = 10 - uploadedImages.length;
            const filesToProcess = files.slice(0, remainingSlots);

            const progressBar = document.querySelector('.progress-bar');
            const progressContainer = document.getElementById('uploadProgress');
            
            progressContainer.classList.remove('d-none');
            
            let loadedCount = 0;
            const totalFiles = filesToProcess.length;

            filesToProcess.forEach((file, index) => {
                // Validate file size (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('Arquivo muito grande', `${file.name} excede 5MB`, 'warning');
                    loadedCount++;
                    updateProgress();
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push(file);
                    loadedCount++;
                    updateProgress();
                    
                    if (loadedCount === totalFiles) {
                        setTimeout(() => {
                            progressContainer.classList.add('d-none');
                            updateImageThumbnails();
                            updateStats();
                            showToast('Sucesso', `${totalFiles} imagem(ns) carregada(s)!`, 'success');
                        }, 500);
                    }
                };
                reader.readAsDataURL(file);
            });

            function updateProgress() {
                const percentage = (loadedCount / totalFiles) * 100;
                progressBar.style.width = percentage + '%';
            }
        }

        // Update image thumbnails
        function updateImageThumbnails() {
            const container = document.getElementById('imageThumbnails');
            const statsContainer = document.getElementById('uploadStats');
            
            if (uploadedImages.length === 0) {
                container.classList.add('d-none');
                statsContainer.classList.add('d-none');
                return;
            }

            container.classList.remove('d-none');
            statsContainer.classList.remove('d-none');
            
            container.innerHTML = '';
            
            uploadedImages.forEach((file, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'image-thumbnail';
                thumbnail.onclick = () => showImagePreview(index);
                
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = `Imagem ${index + 1}`;
                
                const check = document.createElement('div');
                check.className = 'thumbnail-check';
                check.innerHTML = '<i class="bi bi-check"></i>';
                
                thumbnail.appendChild(img);
                thumbnail.appendChild(check);
                container.appendChild(thumbnail);
            });
        }

        // Initialize grid
        function initializeGrid() {
            gridSlots = Array(currentRows * currentCols).fill(null);
            updateGrid();
        }

        // Update grid display
        function updateGrid() {
            const totalSlots = currentRows * currentCols;
            gridSlots = Array(totalSlots).fill(null);
            
            const grid = document.getElementById('photoGrid');
            grid.style.gridTemplateColumns = `repeat(${currentCols}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${currentRows}, 1fr)`;
            
            grid.innerHTML = '';
            
            for (let i = 0; i < totalSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'grid-slot';
                slot.onclick = () => openImageSelector(i);
                
                const empty = document.createElement('div');
                empty.className = 'grid-slot-empty';
                empty.innerHTML = '<i class="bi bi-plus-circle"></i>';
                
                const overlay = document.createElement('div');
                overlay.className = 'grid-slot-overlay';
                overlay.innerHTML = '<i class="bi bi-gear text-white fs-4"></i>';
                
                const badge = document.createElement('div');
                badge.className = 'position-badge';
                badge.textContent = i + 1;
                
                slot.appendChild(empty);
                slot.appendChild(overlay);
                slot.appendChild(badge);
                grid.appendChild(slot);
            }
            
            updateStats();
        }

        // Update statistics
        function updateStats() {
            const totalSlots = currentRows * currentCols;
            const filledSlots = gridSlots.filter(slot => slot !== null).length;
            const totalSize = uploadedImages.reduce((sum, file) => sum + file.size, 0);
            const avgSize = uploadedImages.length > 0 ? totalSize / uploadedImages.length : 0;
            
            document.getElementById('totalSlots').textContent = `${totalSlots} fotos`;
            document.getElementById('imageCount').textContent = uploadedImages.length;
            document.getElementById('totalSize').textContent = (totalSize / (1024 * 1024)).toFixed(1) + 'MB';
            document.getElementById('avgSize').textContent = (avgSize / (1024 * 1024)).toFixed(1) + 'MB';
            document.getElementById('statsImages').textContent = uploadedImages.length;
            document.getElementById('statsSlots').textContent = totalSlots;
            document.getElementById('gridInfo').textContent = `${currentRows} × ${currentCols} = ${totalSlots} posições`;
            document.getElementById('filledInfo').textContent = `${filledSlots}/${totalSlots} preenchidas`;
        }

        // Open image selector modal
        function openImageSelector(slotIndex) {
            if (uploadedImages.length === 0) {
                showToast('Atenção', 'Adicione pelo menos uma imagem primeiro!', 'warning');
                return;
            }
            
            currentSlotIndex = slotIndex;
            document.getElementById('modalPosition').textContent = slotIndex + 1;
            
            updateModalThumbnails();
            
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            modal.show();
        }

        // Update modal thumbnails
        function updateModalThumbnails() {
            const container = document.getElementById('modalThumbnails');
            container.innerHTML = '';
            
            // Add clear option
            const clearOption = document.createElement('div');
            clearOption.className = 'image-thumbnail';
            clearOption.onclick = () => selectImage(null);
            clearOption.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border: 2px dashed #dee2e6;">
                    <i class="bi bi-x-circle text-muted display-6"></i>
                </div>
            `;
            container.appendChild(clearOption);
            
            uploadedImages.forEach((file, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'image-thumbnail';
                if (gridSlots[currentSlotIndex] === index) {
                    thumbnail.classList.add('selected');
                }
                
                thumbnail.onclick = () => selectImage(index);
                thumbnail.ondblclick = () => showPreview(index);
                
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = `Imagem ${index + 1}`;
                
                const check = document.createElement('div');
                check.className = 'thumbnail-check';
                check.innerHTML = '<i class="bi bi-check"></i>';
                
                thumbnail.appendChild(img);
                thumbnail.appendChild(check);
                container.appendChild(thumbnail);
            });
        }

        // Select image for current slot
        function selectImage(imageIndex) {
            gridSlots[currentSlotIndex] = imageIndex;
            updateGridSlot(currentSlotIndex);
            updateStats();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('imageModal'));
            modal.hide();
            
            if (imageIndex !== null) {
                showToast('Sucesso', `Imagem ${imageIndex + 1} aplicada à posição ${currentSlotIndex + 1}`, 'success');
            } else {
                showToast('Sucesso', `Posição ${currentSlotIndex + 1} limpa`, 'success');
            }
        }

        // Update specific grid slot
        function updateGridSlot(slotIndex) {
            const slots = document.querySelectorAll('.grid-slot');
            const slot = slots[slotIndex];
            const imageIndex = gridSlots[slotIndex];
            
            // Get current fit mode
            const fitMode = document.querySelector('input[name="fitMode"]:checked').value;
            
            slot.innerHTML = '';
            
            if (imageIndex !== null && uploadedImages[imageIndex]) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(uploadedImages[imageIndex]);
                img.alt = `Posição ${slotIndex + 1}`;
                
                // Apply fit mode class
                if (fitMode === 'cover') {
                    slot.classList.add('cover-mode');
                    slot.classList.remove('contain-mode');
                } else {
                    slot.classList.add('contain-mode');
                    slot.classList.remove('cover-mode');
                }
                
                slot.appendChild(img);
            } else {
                slot.classList.remove('cover-mode', 'contain-mode');
                const empty = document.createElement('div');
                empty.className = 'grid-slot-empty';
                empty.innerHTML = '<i class="bi bi-plus-circle"></i>';
                slot.appendChild(empty);
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'grid-slot-overlay';
            overlay.innerHTML = '<i class="bi bi-gear text-white fs-4"></i>';
            
            const badge = document.createElement('div');
            badge.className = 'position-badge';
            badge.textContent = slotIndex + 1;
            
            slot.appendChild(overlay);
            slot.appendChild(badge);
        }

        // Update image fit mode for all slots
        function updateImageFitMode(fitMode) {
            const slots = document.querySelectorAll('.grid-slot');
            slots.forEach((slot, index) => {
                if (gridSlots[index] !== null) {
                    if (fitMode === 'cover') {
                        slot.classList.add('cover-mode');
                        slot.classList.remove('contain-mode');
                    } else {
                        slot.classList.add('contain-mode');
                        slot.classList.remove('cover-mode');
                    }
                }
            });
            
            const modeName = fitMode === 'cover' ? 'Preencher' : 'Ajustar';
            showToast('Modo de Imagem', `Modo alterado para: ${modeName}`, 'info');
        }

        // Fill all slots with first image
        function fillAllSlots() {
            if (uploadedImages.length === 0) {
                showToast('Atenção', 'Adicione pelo menos uma imagem primeiro!', 'warning');
                return;
            }
            
            gridSlots.fill(0);
            updateAllGridSlots();
            showToast('Sucesso', 'Primeira imagem aplicada a todas as posições!', 'success');
        }

        // Random fill slots
        function randomFillSlots() {
            if (uploadedImages.length === 0) {
                showToast('Atenção', 'Adicione pelo menos uma imagem primeiro!', 'warning');
                return;
            }
            
            for (let i = 0; i < gridSlots.length; i++) {
                gridSlots[i] = Math.floor(Math.random() * uploadedImages.length);
            }
            updateAllGridSlots();
            showToast('Sucesso', 'Imagens distribuídas aleatoriamente!', 'success');
        }

        // Clear all slots
        function clearAllSlots() {
            gridSlots.fill(null);
            updateAllGridSlots();
            showToast('Sucesso', 'Todas as posições foram limpas!', 'success');
        }

        // Clear specific slot
        function clearSlot() {
            gridSlots[currentSlotIndex] = null;
            updateGridSlot(currentSlotIndex);
            updateStats();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('imageModal'));
            modal.hide();
            
            showToast('Sucesso', `Posição ${currentSlotIndex + 1} limpa`, 'success');
        }

        // Update all grid slots
        function updateAllGridSlots() {
            for (let i = 0; i < gridSlots.length; i++) {
                updateGridSlot(i);
            }
            updateStats();
        }

        // Show preview
        function showPreview(imageIndex) {
            currentPreviewIndex = imageIndex;
            const panel = document.getElementById('previewPanel');
            const img = document.getElementById('previewImage');
            const info = document.getElementById('previewInfo');
            
            img.src = URL.createObjectURL(uploadedImages[imageIndex]);
            info.innerHTML = `
                <div class="mb-2"><strong>Imagem:</strong> #${imageIndex + 1}</div>
                <div class="mb-2"><strong>Nome:</strong> ${uploadedImages[imageIndex].name}</div>
                <div><strong>Tamanho:</strong> ${(uploadedImages[imageIndex].size / (1024 * 1024)).toFixed(1)} MB</div>
            `;
            
            panel.style.display = 'block';
        }

        // Hide preview
        function hidePreview() {
            document.getElementById('previewPanel').style.display = 'none';
            currentPreviewIndex = null;
        }

        // Select image from preview
        function selectImageFromPreview() {
            if (currentPreviewIndex !== null) {
                selectImage(currentPreviewIndex);
            }
        }

        // Copy to all from preview
        function copyToAllFromPreview() {
            if (currentPreviewIndex !== null) {
                gridSlots.fill(currentPreviewIndex);
                updateAllGridSlots();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('imageModal'));
                modal.hide();
                
                showToast('Sucesso', `Imagem ${currentPreviewIndex + 1} aplicada a todas as posições!`, 'success');
            }
        }

        // Print grid
        function printGrid() {
            if (uploadedImages.length === 0) {
                showToast('Atenção', 'Adicione pelo menos uma imagem primeiro!', 'warning');
                return;
            }
            
            window.print();
            showToast('Sucesso', 'Abrindo diálogo de impressão...', 'success');
        }

        // Download grid with enhanced quality
        async function downloadGrid() {
            if (uploadedImages.length === 0) {
                showToast('Atenção', 'Adicione pelo menos uma imagem primeiro!', 'warning');
                return;
            }
            
            try {
                showToast('Processando', 'Gerando imagem em alta qualidade...', 'info');
                
                const grid = document.getElementById('photoGrid');
                
                // Convert all blob URLs to data URLs for better html2canvas compatibility
                const images = grid.querySelectorAll('img');
                const imagePromises = [];
                
                images.forEach(img => {
                    if (img.src.startsWith('blob:')) {
                        const promise = new Promise((resolve) => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            const tempImg = new Image();
                            tempImg.onload = function() {
                                canvas.width = tempImg.naturalWidth;
                                canvas.height = tempImg.naturalHeight;
                                ctx.drawImage(tempImg, 0, 0);
                                
                                const dataUrl = canvas.toDataURL('image/png', 1.0);
                                img.src = dataUrl;
                                resolve();
                            };
                            tempImg.src = img.src;
                        });
                        imagePromises.push(promise);
                    }
                });
                
                // Wait for all images to be converted
                await Promise.all(imagePromises);
                
                // Hide interactive elements
                const overlays = grid.querySelectorAll('.grid-slot-overlay, .position-badge');
                overlays.forEach(el => el.style.display = 'none');
                
                // Wait a moment for images to fully render
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Enhanced html2canvas options for maximum quality
                const canvas = await html2canvas(grid, {
                    scale: 3, // High quality scale
                    backgroundColor: '#ffffff',
                    logging: false,
                    useCORS: true,
                    allowTaint: true, // Allow tainted canvas since we're using data URLs now
                    imageTimeout: 0, // No timeout since images are already loaded
                    removeContainer: false,
                    foreignObjectRendering: false, // Disabled for better compatibility
                    width: grid.offsetWidth,
                    height: grid.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    onclone: function(clonedDoc) {
                        // Ensure images in cloned document are properly loaded
                        const clonedImages = clonedDoc.querySelectorAll('img');
                        clonedImages.forEach(img => {
                            img.style.opacity = '1';
                            img.style.visibility = 'visible';
                        });
                    }
                });
                
                // Restore interactive elements
                overlays.forEach(el => el.style.display = '');
                
                // Create download with timestamp
                const now = new Date();
                const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
                const filename = `chamequinho-HD-${currentRows}x${currentCols}-${timestamp}.png`;
                
                // Convert to blob with maximum quality
                canvas.toBlob(function(blob) {
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = URL.createObjectURL(blob);
                    link.click();
                    
                    // Clean up
                    setTimeout(() => URL.revokeObjectURL(link.href), 1000);
                    
                    showToast('Sucesso HD', `Chamequinho em alta qualidade baixado! (${(blob.size / (1024 * 1024)).toFixed(1)}MB)`, 'success');
                }, 'image/png', 1.0);
                
            } catch (error) {
                showToast('Erro', 'Erro ao baixar o arquivo. Tente novamente.', 'danger');
                console.error('Download error:', error);
                
                // Restore interactive elements in case of error
                const overlays = document.querySelectorAll('.grid-slot-overlay, .position-badge');
                overlays.forEach(el => el.style.display = '');
            }
        }

        // Show toast notification
        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <div class="rounded me-2 ${getToastIconClass(type)}" style="width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi ${getToastIcon(type)} text-white" style="font-size: 0.8rem;"></i>
                        </div>
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 5000 });
            toast.show();
            
            // Remove toast element after it's hidden
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        function getToastIconClass(type) {
            switch (type) {
                case 'success': return 'bg-success';
                case 'warning': return 'bg-warning';
                case 'danger': return 'bg-danger';
                default: return 'bg-primary';
            }
        }

        function getToastIcon(type) {
            switch (type) {
                case 'success': return 'bi-check-circle';
                case 'warning': return 'bi-exclamation-triangle';
                case 'danger': return 'bi-x-circle';
                default: return 'bi-info-circle';
            }
        }

        // Show image preview (for thumbnails)
        function showImagePreview(index) {
            const thumbnails = document.querySelectorAll('#imageThumbnails .image-thumbnail');
            thumbnails.forEach((thumb, i) => {
                thumb.classList.toggle('selected', i === index);
            });
        }
    </script>
</body>
</html>
